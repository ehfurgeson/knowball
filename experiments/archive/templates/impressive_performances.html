{% extends "base.html" %}

{% block title %}NBA Impressive Performances{% endblock %}

{% block content %}
    <div class="page-header">
        <h1>Most Impressive NBA Performances</h1>
        <p class="subtitle">Statistically exceptional performances ranked by z-score</p>
    </div>
    
    <div class="stat-filter">
        <form action="/impressive_performances" method="get">
            <label for="stat-select">Filter by Stat Category:</label>
            <select id="stat-select" name="stat" onchange="this.form.submit()">
                <option value="">All Stats</option>
                <option value="points" {% if selected_stat == 'points' %}selected{% endif %}>Points</option>
                <option value="rebounds" {% if selected_stat == 'rebounds' %}selected{% endif %}>Rebounds</option>
                <option value="assists" {% if selected_stat == 'assists' %}selected{% endif %}>Assists</option>
                <option value="steals" {% if selected_stat == 'steals' %}selected{% endif %}>Steals</option>
                <option value="blocks" {% if selected_stat == 'blocks' %}selected{% endif %}>Blocks</option>
                <option value="field_goal_percentage" {% if selected_stat == 'field_goal_percentage' %}selected{% endif %}>FG%</option>
                <option value="three_point_percentage" {% if selected_stat == 'three_point_percentage' %}selected{% endif %}>3PT%</option>
            </select>
        </form>
    </div>
    
    {% if not performances %}
        <div class="no-data-message">
            <p>No impressive performances found matching the selected criteria.</p>
        </div>
    {% else %}
        <div class="explanation-box">
            <h3>Understanding z-scores</h3>
            <p>Z-scores measure how many standard deviations a performance is above or below average. 
               A z-score above 2.0 indicates a performance in the top 2.3% of all performances, 
               while a z-score above 3.0 is in the top 0.1% (truly exceptional).</p>
            <p>Our algorithm combines both league-wide and player-specific z-scores to identify 
               performances that are impressive both for the individual player and when compared to the entire league.</p>
        </div>
        
        <div class="performances-container">
            {% if selected_stat %}
                <h2>{{ selected_stat.replace('_', ' ').title() }} Performances</h2>
                <div class="performance-list">
                    {% for perf in performances %}
                        <div class="performance-card large">
                            <div class="z-score-banner {% if perf.z_score > 3 %}exceptional{% elif perf.z_score > 2.5 %}excellent{% elif perf.z_score > 2 %}very-good{% else %}good{% endif %}">
                                <span class="z-score-value">{{ "%.2f"|format(perf.z_score) }}</span>
                                <span class="z-score-label">z-score</span>
                            </div>
                            <div class="performance-content">
                                <h3 class="player-name"><a href="/player/{{ perf.player_name }}">{{ perf.player_name }}</a></h3>
                                <div class="stat-highlight">
                                    <span class="value">{{ perf.value }}</span>
                                    <span class="type">{{ perf.stat_type.replace('_', ' ').title() }}</span>
                                </div>
                                <div class="game-details">
                                    <span class="date">{{ perf.game_date.strftime('%B %d, %Y') }}</span>
                                    <span class="teams">{{ perf.home_team }} vs {{ perf.away_team }}</span>
                                    <span class="season">{{ perf.season }} Season</span>
                                </div>
                                <div class="rank-info">
                                    {% if perf.league_rank %}
                                        <span class="rank-item">League Rank: <strong>#{{ perf.league_rank }}</strong></span>
                                    {% endif %}
                                    {% if perf.player_rank %}
                                        <span class="rank-item">Player Career Rank: <strong>#{{ perf.player_rank }}</strong></span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                {% for stat_type, perfs in performances_by_stat.items() %}
                    <div class="stat-section">
                        <h2>{{ stat_type.replace('_', ' ').title() }}</h2>
                        <div class="performance-grid">
                            {% for perf in perfs[:10] %}
                                <div class="performance-card">
                                    <div class="z-score-banner {% if perf.z_score > 3 %}exceptional{% elif perf.z_score > 2.5 %}excellent{% elif perf.z_score > 2 %}very-good{% else %}good{% endif %}">
                                        <span class="z-score-value">{{ "%.2f"|format(perf.z_score) }}</span>
                                    </div>
                                    <div class="performance-content">
                                        <h3 class="player-name"><a href="/player/{{ perf.player_name }}">{{ perf.player_name }}</a></h3>
                                        <div class="stat-highlight">
                                            <span class="value">{{ perf.value }}</span>
                                            <span class="type">{{ stat_type.replace('_', ' ').title() }}</span>
                                        </div>
                                        <div class="game-details">
                                            <span class="date">{{ perf.game_date.strftime('%b %d, %Y') }}</span>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                            
                            {% if perfs|length > 10 %}
                                <div class="view-more">
                                    <a href="/impressive_performances?stat={{ stat_type }}" class="view-more-link">
                                        View all {{ perfs|length }} {{ stat_type.replace('_', ' ').title() }} performances
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    {% endif %}
{% endblock %}
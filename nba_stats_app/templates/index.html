<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NBA Player Stats</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>NBA Player Stats Visualizer</h1>
        {% if error %}
        <p class="error">{{ error }}</p>
        {% endif %}
        <form action="/player_stats" method="post">
            <div class="input-container">
                <input type="text" 
                       id="player-name" 
                       name="player_name" 
                       placeholder="Enter Player Name" 
                       required
                       autocomplete="off">
            </div>
            <select name="season">
                <option value="2023-24" selected>2023-24 Season</option>
                <option value="2022-23">2022-23 Season</option>
                <option value="2021-22">2021-22 Season</option>
            </select>
            <button type="submit">Get Stats</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const playerNameInput = document.getElementById('player-name');
            
            // Use Choices.js for autocomplete
            const choices = new Choices(playerNameInput, {
                searchEnabled: true,
                searchPlaceholderValue: 'Search players...',
                noResultsText: 'No players found',
                itemSelectText: 'Select player',
                searchFloor: 2, // Minimum characters to trigger search
                searchResultLimit: 10, // Limit number of results
                shouldSort: false, // Let server handle sorting
                placeholder: true,
                placeholderValue: 'Enter Player Name'
            });

            // Fetch player suggestions on input
            playerNameInput.addEventListener('search', function(event) {
                const query = event.detail.value;
                
                if (query.length < 2) return;

                fetch(`/player_suggestions?q=${query}`)
                    .then(response => response.json())
                    .then(suggestions => {
                        // Clear existing options
                        choices.clearChoices();
                        
                        // Add new suggestions
                        suggestions.forEach(suggestion => {
                            choices.setChoices([
                                {value: suggestion, label: suggestion}
                            ], 'value', 'label', false);
                        });
                    })
                    .catch(error => console.error('Error:', error));
            });
        });
    </script>
</body>
</html>
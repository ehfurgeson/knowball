{% extends "base.html" %}

{% block title %}NBA League Statistics{% endblock %}

{% block content %}
    <div class="league-header">
        <h1>NBA League Statistics</h1>
        <div class="season-selector">
            <form action="/league_stats" method="get">
                <select name="season" class="season-select" onchange="this.form.submit()">
                    {% for s in available_seasons %}
                        <option value="{{ s }}" {% if s == season %}selected{% endif %}>{{ s }} Season</option>
                    {% endfor %}
                </select>
            </form>
        </div>
    </div>
    
    <div class="stat-tabs">
        <button class="stat-tab active" data-tab="distributions">Statistical Distributions</button>
        <button class="stat-tab" data-tab="leaders">League Leaders</button>
    </div>
    
    <div class="tab-content active" id="distributions-content">
        <div class="distribution-selector">
            <label for="dist-stat-select">Select Stat:</label>
            <select id="dist-stat-select">
                <option value="points">Points</option>
                <option value="rebounds">Rebounds</option>
                <option value="assists">Assists</option>
                <option value="steals">Steals</option>
                <option value="blocks">Blocks</option>
                <option value="minutes">Minutes</option>
                <option value="field_goal_percentage">FG%</option>
                <option value="three_point_percentage">3PT%</option>
            </select>
        </div>
        
        <div class="distribution-charts">
            {% for stat, chart in distribution_charts.items() %}
                {% if '_hist' in stat %}
                    {% set base_stat = stat.replace('_hist', '') %}
                    <div class="distribution-section" id="{{ base_stat }}-distribution" style="display: none;">
                        <div class="chart-container full-width">
                            <h3>League-wide {{ base_stat.replace('_', ' ').title() }} Distribution</h3>
                            <div class="chart">
                                {{ chart|safe }}
                            </div>
                            <div class="distribution-description">
                                <p>This chart shows the distribution of {{ base_stat.replace('_', ' ').lower() }} across all NBA players in the {{ season }} season.</p>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    
    <div class="tab-content" id="leaders-content">
        <div class="leader-tabs">
            <button class="leader-tab active" data-tab="points">Points</button>
            <button class="leader-tab" data-tab="rebounds">Rebounds</button>
            <button class="leader-tab" data-tab="assists">Assists</button>
            <button class="leader-tab" data-tab="steals">Steals</button>
            <button class="leader-tab" data-tab="blocks">Blocks</button>
        </div>
        
        <div class="leader-content active" id="points-leaders">
            <h3>Points Per Game Leaders</h3>
            <div class="leaders-table-container">
                <table class="leaders-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>PPG</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for index, player in enumerate(top_performers.points) %}
                            <tr>
                                <td>{{ index + 1 }}</td>
                                <td><a href="/player/{{ player.full_name }}">{{ player.full_name }}</a></td>
                                <td>{{ "%.1f"|format(player.avg_value) }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="leader-content" id="assists-leaders">
            <h3>Assists Per Game Leaders</h3>
            <div class="leaders-table-container">
                <table class="leaders-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>APG</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for index, player in enumerate(top_performers.assists) %}
                            <tr>
                                <td>{{ index + 1 }}</td>
                                <td><a href="/player/{{ player.full_name }}">{{ player.full_name }}</a></td>
                                <td>{{ "%.1f"|format(player.avg_value) }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="leader-content" id="steals-leaders">
            <h3>Steals Per Game Leaders</h3>
            <div class="leaders-table-container">
                <table class="leaders-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>SPG</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for index, player in enumerate(top_performers.steals) %}
                            <tr>
                                <td>{{ index + 1 }}</td>
                                <td><a href="/player/{{ player.full_name }}">{{ player.full_name }}</a></td>
                                <td>{{ "%.1f"|format(player.avg_value) }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="leader-content" id="blocks-leaders">
            <h3>Blocks Per Game Leaders</h3>
            <div class="leaders-table-container">
                <table class="leaders-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>BPG</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for index, player in enumerate(top_performers.blocks) %}
                            <tr>
                                <td>{{ index + 1 }}</td>
                                <td><a href="/player/{{ player.full_name }}">{{ player.full_name }}</a></td>
                                <td>{{ "%.1f"|format(player.avg_value) }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Main tabs
        const statTabs = document.querySelectorAll('.stat-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        statTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                statTabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab + '-content').classList.add('active');
                
                // Initialize appropriate sub-content
                if (tab.dataset.tab === 'distributions') {
                    showDistribution('points');
                }
            });
        });
        
        // Distribution selector
        const distStatSelect = document.getElementById('dist-stat-select');
        
        if (distStatSelect) {
            distStatSelect.addEventListener('change', () => {
                showDistribution(distStatSelect.value);
            });
            
            // Show points distribution by default
            showDistribution('points');
        }
        
        function showDistribution(statType) {
            const distSections = document.querySelectorAll('.distribution-section');
            distSections.forEach(section => {
                section.style.display = 'none';
            });
            
            const selectedSection = document.getElementById(statType + '-distribution');
            if (selectedSection) {
                selectedSection.style.display = 'block';
            }
        }
        
        // Leader tabs
        const leaderTabs = document.querySelectorAll('.leader-tab');
        const leaderContents = document.querySelectorAll('.leader-content');
        
        leaderTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                leaderTabs.forEach(t => t.classList.remove('active'));
                leaderContents.forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab + '-leaders').classList.add('active');
            });
        });
    });
</script>
{% endblock %}.full_name }}</a></td>
                                <td>{{ "%.1f"|format(player.avg_value) }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="leader-content" id="rebounds-leaders">
            <h3>Rebounds Per Game Leaders</h3>
            <div class="leaders-table-container">
                <table class="leaders-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>RPG</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for index, player in enumerate(top_performers.rebounds) %}
                            <tr>
                                <td>{{ index + 1 }}</td>
                                <td><a href="/player/{{ player.full_name }}">{{ player